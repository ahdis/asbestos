<TestScript xmlns="http://hl7.org/fhir">
    <modifierExtension url="urn:module">
        <extension url="urn:fixture-in">
            <valueString value="response"/>
        </extension>
        <extension url="urn:fixture-in">
            <valueString value="request"/>
        </extension>
        <extension url="urn:variable-in">
            <valueString value="requestResourceProfile"/>
        </extension>
        <extension url="urn:variable-in">
            <valueString value="responseResourceType"/>
        </extension>
    </modifierExtension>


    <!-- this testscript can be generic since profile is parameterized -->

    <id value="MHDv4StructureDefinitionValidation"/>
    <name value="MHDv4StructureDefinitionValidation"/>
    <description value="Validation server is the channel Id, which is composed of testSession and channelName, joined by two underscore characters. For example, testSession__channelName. This channel Id will be resolved to a FHIR base address through an internal operation module call."/>

    <variable>
        <name value="validationServer"/>
        <defaultValue value="default__default"/>
    </variable>
    <variable>
        <name value="resourceType"/>
        <defaultValue value="Bundle"/>
    </variable>

    <setup>
        <modifierExtension url="urn:noErrors"/>
        <action>
            <operation>
                <description value="Get validation server base address"/>
                <modifierExtension url="https://github.com/usnistgov/asbestos/wiki/TestScript-Import">
                    <extension url="component">
                        <valueString value="../Library/Get?.xml"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="?"/>
                    </extension>
                    <extension url="urn:fixture-out">
                        <valueString value="?"/>
                    </extension>
                </modifierExtension>
            </operation>
        </action>
    </setup>


    <test>
        <description value="Request - Structure definition based resource validation."/>
        <action>
            <operation>
                <description value="Test action operation is analyzed using assertions."/>
                <modifierExtension url="https://github.com/usnistgov/asbestos/wiki/TestScript-Import">
                    <extension url="component">
                        <valueString value="../../Library/StructureDefinitionValidationMain.xml"/>
                    </extension>
                    <extension url="urn:fixture-in">
                        <valueString value="request"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="validationServer"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="resourceType"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="requestResourceProfile"/>
                    </extension>
                </modifierExtension>
            </operation>
        </action>
    </test>

    <!-- this should be conditional on the responseResourceType, if matches (ex. Bundle), call $validate without a profile -->
    <test>
        <description value="Response - Structure definition based resource validation."/>
        <action>
            <operation>
                <description value="Test action operation is analyzed using assertions."/>
                <modifierExtension url="https://github.com/usnistgov/asbestos/wiki/TestScript-Import">
                    <extension url="component">
                        <valueString value="../../Library/StructureDefinitionValidationMain.xml"/>
                    </extension>
                    <extension url="urn:fixture-in">
                        <valueString value="response"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="validationServer"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="resourceType"/>
                    </extension>
                    <extension url="urn:variable-in">
                        <valueString value="responseResourceProfile"/>
                    </extension>
                </modifierExtension>
            </operation>
        </action>
    </test>



</TestScript>
